/*
Basic Queries
 1) Retrieve all books in the "Fiction" genre
 2) Find books published after the year 1950
 3) List all customers from the Canada
 4) Show orders placed in November 2023
 5) Retrieve the total stock of books available
 6) Find the details of the most expensive book
 7) Show all customers who ordered more than 1 quantity of a book
 8) Retrieve all orders where the total amount exceeds $20
 9) List all genres available in the Books table
 10) Find the book with the lowest stock
 11) Calculate the total revenue generated from all orders

Advance Queries
 1) Retrieve the total number of books sold for each genre
 2) Find the average price of books in the "Fantasy" genre
 3) List customers who have placed at least 2 orders
 4) Find the most frequently ordered book
 5) Show the top 3 most expensive books of 'Fantasy' Genre 
 6) Retrieve the total quantity of books sold by each author
 7) List the cities where customers who spent over $30 are located
 8) Find the customer who spent the most on orders
 9) Calculate the stock remaining after fulfilling all orders
*/

create database Book_store;
use Book_store;

show tables;

-- 01) Retrieve all books in the "Fiction" genre
select * 
from books
where genre = "Fiction";

-- 02) Find books published after the year 1950
select * 
from books
where Published_Year >= 1950;

-- 03) List all customers from the Canada
select *
from customers
where city = 'canada';

-- 04) Show orders placed in November 2023
select *
from orders
where order_date >= '2023-11-01'
and order_date < '2023-12-01';

-- 05) Retrieve the total stock of books available
select sum(Quantity) as total_stock
from orders;

-- 06) Find the details of the most expensive book
select *
from books
where price = (select max(price) from books);

-- 07) Show all customers who ordered more than 1 quantity of a book
select c.Customer_ID, c.Name
from customers c
join orders o
on c.customer_id = o.customer_id
where quantity >  1;

-- 08) Retrieve all orders where the total amount exceeds $20
select *
from orders
where Total_amount > 20;

-- 09) List all genres available in the Books table
select distinct genre
from books;

 -- 10) Find the book with the lowest stock
 select title, price, stock, min(stock) as minimun_stock
 from books
 group by title, price, stock
 order by stock asc
 limit 10;
 
 -- 11) Calculate the total revenue generated from all orders
SELECT 
    b.Book_Id,
    o.Quantity,
    SUM(quantity * price) AS total_revenue
FROM
    orders o
        JOIN
    Books b ON o.Book_ID = b.Book_ID
GROUP BY o.Book_ID , o.Quantity;

select count(order_id)
from orders;

-- Advanced Queries
-- 01) Retrieve the total number of books sold for each genre
SELECT b.genre, SUM(o.quantity) AS total_books_sold
FROM Orders o
JOIN Books b ON o.book_id = b.book_id
GROUP BY b.genre;

-- 02) Find the average price of books in the "Fantasy" genre
SELECT AVG(price) AS avg_price
FROM Books
WHERE genre = 'Fantasy';

-- 03) List customers who have placed at least 2 orders
select customer_id, count(order_id) as total_orders
from orders
group by customer_id
having count(order_id) >= 2;

